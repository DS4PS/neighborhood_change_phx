---
title: "PEDA Capstone"
output:
   flexdashboard::flex_dashboard:
    theme: spacelab
    social: menu
    source: embed
    smart: false
runtime: shiny
---

```{r setup, chunk-1, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(flexdashboard)
library(knitr, quietly=TRUE)
library(dplyr, quietly=TRUE)
library(pander, quietly=TRUE)
library(devtools, quietly=TRUE)
library(censusapi, quietly=TRUE)
library(maptools, quietly=TRUE)
library(rgdal, quietly=TRUE)
library(geojsonio, quietly=TRUE)
library(rmapshaper, quietly=TRUE)
library(sf, quietly=TRUE)
library(ggplot2, quietly=TRUE)
library(tidyr, quietly=TRUE)
library(viridis, quietly=TRUE)
library(gridExtra, quietly=TRUE)
library( leaflet, quietly=TRUE )
library( sp, quietly=TRUE)
library(broom, quietly=TRUE)
library(DT, quietly=TRUE)
library(tigris, quietly=TRUE)

```

```{r, chunk-2, include=FALSE, cache=FALSE}
# Import Shapefile

download.file( "https://github.com/lecy/neighborhood_change_phx/raw/master/shapefiles/tl_2010_04013_tract10.zip", 
"maricopa-az-census_tract10.zip" )
unzip( "maricopa-az-census_tract10.zip" )
file.remove( "maricopa-az-census_tract10.zip" )
dir()

library( rgdal )
phx <- readOGR("tl_2010_04013_tract10.shp")
head( phx@data, 10)
plot( phx )

phx <- spTransform( phx, CRS("+proj=longlat +datum=WGS84") )

phx$geoid2 <- paste0( "G", phx$STATEFP10, 
                     "0", phx$COUNTYFP10, "0", phx$TRACTCE10 )
```

Narrative {data-orientation=columns}
=====================================  

Column {data-width=400}
-------------------------------------

```{r}
plot(phx)
```


Column {data-width=600}
-------------------------------------
### Project Narrative Overview
This project is an analysis of Phoenix demographic data changes from 1990-2015 indicating potential neighborhood change. It was done as the Capstone project for students in the Master of Program Evaluation and Data Analytics Program through the Watts College of Public Service and Community Solutions at ASU. 

This dashboard identifies four demographic changes to consider: 

* Race from 1990 - 2015

* Ethnicity from 1990 - 2015

* Homes for Sale from 1990-2015

* Income from 2010-2015



Race {data-orientation=rows}
=====================================     
```{r, include=FALSE}
dat.url <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/race.dashboard.dat.csv"

race.dat <- read.csv( dat.url, stringsAsFactors=F )

race.shape.data <- merge(phx, race.dat, by.x="geoid2", by.y="GISJOIN", all.x=T)

phx_fortified <- tidy( phx, region = "geoid2")

race.fortified <- merge( phx_fortified, race.dat, by.x="id", by.y="GISJOIN", all.x=T)
```

Row {data-height=400}
-----------------------------------------------------------------------


###Dot Map Race 1990
```{r, include=FALSE}

#Data

URL <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/race.dashboard.dat.csv"

race.dashboard <- read.csv( URL, stringsAsFactors=FALSE )
# Join
phx2 <- geo_join( phx, race.dashboard, by_sp="geoid2", by_df="GISJOIN", how="left" )
# Maps

White_1990 <- dotsInPolys( phx2 , race.dashboard$White_1990/100, f = "random", offset, compatible = FALSE)

Black_1990 <- dotsInPolys( phx2 , race.dashboard$Black_1990/100, f = "random", offset, compatible = FALSE)

NativeAmAlaskan_1990 <- dotsInPolys( phx2 , race.dashboard$NativeAmAlaskan_1990/100, f = "random", offset, compatible = FALSE)

Asian_1990 <- dotsInPolys( phx2 , race.dashboard$Asian_1990/100, f = "random", offset, compatible = FALSE)

NativeHawaiianPacificIslander_1990 <- dotsInPolys( phx2 , race.dashboard$NativeHawaiianPacificIslander_1990/1, f = "random", offset, compatible = FALSE)

SomeOther_1990 <- dotsInPolys( phx2 , race.dashboard$SomeOther_1990/100, f = "random", offset, compatible = FALSE)
```
```{r}
par( mar=c(0,0,0,0) )

plot( phx2, border="black", xlim=NULL, ylim=NULL )
points( White_1990, col=adjustcolor("firebrick", alpha.f=0.2), pch=19, cex=0.7 )
points( Black_1990, col=adjustcolor("darkgoldenrod2", alpha.f=0.2), pch=19, cex=0.7 )
points( NativeAmAlaskan_1990, col=adjustcolor("forestgreen", alpha.f=0.2), pch=19, cex=0.7 )
points( Asian_1990, col=adjustcolor("darkviolet", alpha.f=0.2), pch=19, cex=0.7 )
points( NativeHawaiianPacificIslander_1990, col=adjustcolor("deeppink4", alpha.f=0.2), pch=19, cex=0.7 )
points( SomeOther_1990, col=adjustcolor("darkslategray3", alpha.f=0.2), pch=19, cex=0.7 )
```

Row {data-height=300}
----------------------------

### Dot Map Race 2015
```{r, include=FALSE}
White_2015 <- dotsInPolys( phx2 , race.dashboard$White_2015/100, f = "random", offset, compatible = FALSE)

Black_2015 <- dotsInPolys( phx2 , race.dashboard$Black_2015/100, f = "random", offset, compatible = FALSE)

AmericanIndian_2015 <- dotsInPolys( phx2 , race.dashboard$AmericaIndian_2015/100, f = "random", offset, compatible = FALSE)

Asian_2015 <- dotsInPolys( phx2 , race.dashboard$Asian_2015/100, f = "random", offset, compatible = FALSE)

PacificIslander_2015 <- dotsInPolys( phx2 , race.dashboard$PacificIslander_2015/1, f = "random", offset, compatible = FALSE)

OtherRace_2015 <- dotsInPolys( phx2 , race.dashboard$OtherRace_2015/100, f = "random", offset, compatible = FALSE)

TwoPlusRaces_2015 <- dotsInPolys( phx2 , race.dashboard$TwoPlusRaces_2015/100, f = "random", offset, compatible = FALSE)
```
```{r}
par( mar=c(0,0,0,0) )

plot( phx2, border="black", xlim=NULL, ylim=NULL )

points( White_2015, col=adjustcolor("firebrick", alpha.f=0.2), pch=19, cex=0.7 )

points( Black_2015, col=adjustcolor("darkgoldenrod2", alpha.f=0.2), pch=19, cex=0.7 )

points( AmericanIndian_2015, col=adjustcolor("forestgreen", alpha.f=0.2), pch=19, cex=0.7 )

points( Asian_2015, col=adjustcolor("darkviolet", alpha.f=0.2), pch=19, cex=0.7 )

points( PacificIslander_2015, col=adjustcolor("deeppink4", alpha.f=0.2), pch=19, cex=0.7 )

points( OtherRace_2015, col=adjustcolor("darkslategray3", alpha.f=0.2), pch=19, cex=0.7 )

points( TwoPlusRaces_2015, col=adjustcolor("blue", alpha.f=0.2), pch=19, cex=0.7 )

```
  
Row {.tabset .tabset-fade}
---------------------------------

###White

```{r}
hist(race.dashboard$White_1990,col=rgb(178,34,34, alpha=100, maxColorValue = 178), xlab="White Population Counts",main="Histograms for\n White Popluation in 1990 and 2015", breaks=40,  ylim=range(0:75))
hist(race.dashboard$White_2015,col=rgb(170,30,30, alpha=100, maxColorValue = 170), add=TRUE, breaks=40)

```

###Black
```{r}
hist(race.dashboard$Black_1990,col=rgb(184,134,11, alpha=100, maxColorValue = 184), xlab="Black Population Counts",main="Histograms for\n Black Popluation in 1990 and 2015", breaks=30,  ylim=range(0:75))
hist(race.dashboard$Black_2015,col=rgb(175,130,9, alpha=100, maxColorValue = 175), add=TRUE, breaks=30)

```

###Asian

```{r}
hist(race.dashboard$Asian_1990,col=rgb(148,0,211, alpha=100, maxColorValue = 211), xlab="Asian Population Counts",main="Histograms for\n Asian Popluation in 1990 and 2015", breaks=40)
hist(race.dashboard$Asian_2015,col=rgb(140,0,200, alpha=100, maxColorValue = 200), add=TRUE, breaks=40)

```

###Native American

```{r}
hist(race.dashboard$NativeAmAlaskan_1990,col=rgb(34,150,34, alpha=100, maxColorValue = 150), xlab="Native American Population Counts",main="Histograms for\n Native American Popluation in 1990 and 2015", breaks=40, ylim=range(0:75))
hist(race.dashboard$AmericaIndian_2015, col=rgb(20,120,20, alpha=100, maxColorValue = 130), add=TRUE, breaks=40)

```

###Pacific Islander


```{r}
hist(race.dashboard$NativeHawaiianPacificIslander_1990,col=rgb(255,20,147, alpha=100, maxColorValue = 255), xlab="Native Hawaiian and Pacific Islander Population Counts",main="Histograms for\n Native Hawaiian and Pacific Islander\n Popluation in 1990 and 2015", breaks=30, ylim=range(0:75))
hist(race.dashboard$PacificIslander_2015, col=rgb(245,20,140, alpha=100, maxColorValue = 245), add=TRUE, breaks=70)

```

###Some other race

```{r}
hist(race.dashboard$SomeOther_1990,col=rgb(120,135,120, alpha=24, maxColorValue = 144), xlab="Some Other Race Population Counts",main="Histograms for\n Some Other Race Popluation in 1990 and 2015", breaks=40, ylim=range(0:75))
hist(race.dashboard$OtherRace_2015, col=rgb(140,160,120, alpha=50, maxColorValue = 160), add=TRUE, breaks=40)

```

###Two or more
```{r}
## Note: This category did not exist on the 1990 census

hist(race.dashboard$TwoPlusRaces_2015,col="blue", xlab="Two+ Races Population Counts",main="Histogram for\n Two or more races Popluation in 2015", breaks=40, ylim=range(0:75))

```



Ethnicity {data-orientation=rows}
=====================================     

```{r, chunk-dat2, include=FALSE}


dat.url <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/ethnicity.dashboard.dat.csv"

ethnicity.dat <- read.csv( dat.url, stringsAsFactors=F )

ethnicity.shape.data <- merge(phx, ethnicity.dat, by.x="geoid2", by.y="GISJOIN", all.x=T)

phx_fortified <- tidy( phx, region = "geoid2")

ethnicity.fortified <- merge( phx_fortified, ethnicity.dat, by.x="id", by.y="GISJOIN", all.x=T)


```

Row {data-height=400}
-------------------------------------



### Chloropleth % Hispanic 1990
```{r, include=FALSE}
hispanic_1990 <- ggplot( data = ethnicity.fortified, 
               aes( x = long, y = lat, 
                    group = group, 
                    fill = HispanicPercent_1990 ) ) + 
                geom_polygon() +
               coord_map() +
               scale_fill_distiller(palette="Set3", direction=1,
                                    name="Percent") +
     labs(title="Hispanic/Latino 1990 Population\n in Maricopa County", title.cex=.75, caption="1990 Source: US Census, NHGIS")
```
```{r}
hispanic_1990
```


### Chloropleth % Hispanic 2015
```{r, include=FALSE}
hispanic_2015 <- ggplot( data = ethnicity.fortified, 
               aes( x = long, y = lat, 
                    group = group, 
                    fill = HispanicPercent_2015 ) ) + 
                geom_polygon() +
               coord_map() +
               scale_fill_distiller(palette="Set3", direction=1,
                                    name="Percent") +
     labs(title="Hispanic/Latino 2015 Population\n in Maricopa County", title.cex=.75, caption="2015 Source: US Census, ACS5")
```
```{r}
hispanic_2015
```


Row {data-height=500}
-------------------------------------  
### Area Chart % Hispanic 1990-2015



Homes for Sale {data-orientation=rows}
=====================================     
   
 
Row {data-height=400}
-------------------------------------

### Dot Map Houses for sale 2000


### Dot Map Houses for sale 2010

Row {data-height=500}
-------------------------------------  
### Stacked Bar Chart


Income {data-orientation=rows}
=====================================     
 
Row {data-height=400}
-------------------------------------

### Dot Map Income 2010

```{r}



```

### Dot Map Income 2015

```{r}



```   

Row {data-height=500}
-------------------------------------  
### Chloropleth below poverty 2010

```{r}
```

### Chloropleth below poverty 2015

Total {data-orientation=columns}
=====================================   

Inputs {.sidebar data-width=300}
-----------------------------------------------------------------------

```{r}
# shiny inputs defined here
# Reactive function
```
Column
-----------------------------------------------------------------------

### Geyser Eruption Duration

```{r}
# renderPlot
```


Dataset {data-orientation=rows}
=====================================     

### NHGIS 1990,2000,2010 & ACS 2010, 2015

This data table is a sample of the full dataset, including only those variables used in the narratives of this dashboard. Additionally, due to the size of the tidy dataset used in this dashboard, this is only the first 800 observations. For a full dataset, please visit ("link here"). 

```{r, chunk-14, include=FALSE}
dat.url <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/tidy.dashboard.dat.csv"
table.dat <- read.csv( dat.url, stringsAsFactors=F )

table.dat <- table.dat[1:800,]

```

```{r, include=FALSE}
these.buttons <- c( 'copy', 'csv', 'excel' )

dat.selected.table <- datatable( table.dat,
           filter='top', rownames=FALSE, 
           #options=list( pageLength=50, autoWidth=TRUE ),
           fillContainer=TRUE, 
           style="default",
           class='table-condensed table-striped',
           extensions = 'Buttons', 
           options=list( dom='Bfrtip', 
                         buttons=these.buttons  )) %>%
  formatStyle( "GISJOIN", "white-space"="nowrap" )



```

```{r}

dat.selected.table

```

Variable Crosswalk {data-orientation=rows}
=====================================     
   

### Data Table Variable Names

This data table includes the names of the different variables from 1990-2015. Notes that 1990, 2000, and 2010 are the variable names from the NHGIS time series data tables downloaded at ("link goes here"). The 2015 variable names are those used to download data from the ACS 5 using the censusapi() package ("link goes here").

```{r, chunk-15, include=FALSE}

url2 <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/phx.variable.name.crosswalk.csv"

phx.var.crosswalk <- read.csv( url2, stringsAsFactors = F)

these.buttons <- c( 'copy', 'csv', 'excel' )

phx.var.datatable <- datatable( phx.var.crosswalk,
           filter='top', rownames=FALSE, 
           #options=list( pageLength=50, autoWidth=TRUE ),
           fillContainer=TRUE, 
           style="default",
           class='table-condensed table-striped',
           extensions = 'Buttons', 
           options=list( dom='Bfrtip', 
                         buttons=these.buttons  )) %>%
  formatStyle( "construct", "white-space"="nowrap" )

```

```{r}
phx.var.datatable
```
