---
title: "Capstone Dashboard"
author: "Kendelle Brown, Abby Henderson"
date: "April 14, 2019"
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r setup, chunk-1, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(flexdashboard)
library(knitr, quietly=TRUE)
library(dplyr, quietly=TRUE)
library(pander, quietly=TRUE)
library(devtools, quietly=TRUE)
library(censusapi, quietly=TRUE)
library(maptools, quietly=TRUE)
library(rgdal, quietly=TRUE)
library(geojsonio, quietly=TRUE)
library(rmapshaper, quietly=TRUE)
library(sf, quietly=TRUE)
library(ggplot2, quietly=TRUE)
library(tidyr, quietly=TRUE)
library(viridis, quietly=TRUE)
library(gridExtra, quietly=TRUE)
library( leaflet, quietly=TRUE )
library( sp, quietly=TRUE)
library(broom, quietly=TRUE)
library(DT, quietly=TRUE)

```

```{r, chunk-2, include=FALSE, cache=FALSE}
# Import Shapefile

download.file( "https://github.com/lecy/neighborhood_change_phx/raw/master/shapefiles/tl_2010_04013_tract10.zip", 
"maricopa-az-census_tract10.zip" )
unzip( "maricopa-az-census_tract10.zip" )
file.remove( "maricopa-az-census_tract10.zip" )
dir()

library( rgdal )
phx <- readOGR("tl_2010_04013_tract10.shp")
head( phx@data, 10)
plot( phx )

phx <- spTransform( phx, CRS("+proj=longlat +datum=WGS84") )

phx$geoid2 <- paste0( "G", phx$STATEFP10, 
                     "0", phx$COUNTYFP10, "0", phx$TRACTCE10 )
```


```

Narrative
=====================================  
    
Column {data-width=600}
-------------------------------------

### Narrative
    
### The narrative will go here.

This project is an analysis of Phoenix demographic data changes from 1990-2015 indicating potential neighborhood change. It was done as the Capstone project for students in the Master of Program Evaluation and Data Analytics Program through the Watts College of Public Service and Community Solutions at ASU. 

This dashboard identifies four demographic changes to consider: 
Race from 1990 - 2015
Ethnicity from 1990 - 2015
Percentage of Homes for Sale from 1990-2015
Income, with a focus on the highest income households and those below the poverty line from 2010-2015


Race {data-orientation=rows}
=====================================     

Inputs {.sidebar data-width=300}
-----------------------------------------------------------------------
```{r, include=FALSE}


dat.url <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/race.dashboard.dat.csv"

race.dat <- read.csv( dat.url, stringsAsFactors=F )

race.shape.data <- merge(phx, race.dat, by.x="geoid2", by.y="GISJOIN", all.x=T)

phx_fortified <- tidy( phx, region = "geoid2")

race.fortified <- merge( phx_fortified, race.dat, by.x="id", by.y="GISJOIN", all.x=T)

race.dash <- gather(  race.fortified, "var_name", "value", 11:38 )

race.dash <- separate( race.dash, var_name, c("level", "year")  )




```




```{r, chunk-3, include=TRUE, cache=FALSE}

ui <- fluidPage(
    
  selectInput(inputId= "select", label = h3("Select Year"), 
    choices = list("1990" = 1990, "2000" = 2000, "2010" = 2010, "2015" = 2015), 
    selected = 2000),
  
  hr(),
  fluidRow(column(3, verbatimTextOutput("value")))
  
)

server <- function(input,output)
{

  
  output$value <- renderPrint({ input$select })

}

shinyApp(ui = ui, server=server)
```
   
Row {data-height=400}
-------------------------------------

### Map 1

```{r, chunk-4}
#filler



```

### Map 2

```{r, chunk-5}
#filler




```   

Row {data-height=500}
-------------------------------------  
### Analysis



Ethnicity {data-orientation=rows}
=====================================     

Inputs {.sidebar data-width=300}
-------------------------------------

```{r, chunk-6, cache=FALSE}
# shiny inputs defined here


ui <- fluidPage(

radioButtons(inputId = "radio", label = h3("Select a year"), choices = list("1990" = 1990, "2000" = 2000, "2010" = 2010, "2015" = 2015), selected=2000 ),
  
hr(),
fluidRow(column(3, verbatimTextOutput("value")))
)

server <- function(input, output) { 

  output$value <- renderPrint({input$radio })
  }

shinyApp(ui = ui, server=server)


```
 
Row {data-height=400}
-------------------------------------

### Map 1

```{r, chunk-7}


```

### Map 2

```{r, chunk-8}


```   

Row {data-height=500}
-------------------------------------  
### Analysis

```{r, chunk-9}
```

Homes for Sale {data-orientation=rows}
=====================================     
   
Inputs {.sidebar data-width=300}
-------------------------------------

```{r, chunk-10, include=FALSE, cache=FALSE}
# shiny inputs defined here



ui <- fluidPage(

radioButtons(inputId = "radio", label = h3("Select a year"), choices = list("1990" = 1990, "2000" = 2000, "2010" = 2010, "2015" = 2015), selected=2000 ),
  
hr(),
fluidRow(column(3, verbatimTextOutput("value")))
)

server <- function(input, output) { 

  output$value <- renderPrint({input$radio })
}

shinyApp(ui = ui, server=server)
```

```{r, cache=FALSE, include=TRUE}
shinyApp(ui = ui, server=server)
```
 
Row {data-height=400}
-------------------------------------

### Map 1

```{r, chunk-11}



```

### Map 2

```{r, chunk-12}



```   

Row {data-height=500}
-------------------------------------  
### Analysis

```{r, chunk-13}
```

Income {data-orientation=rows}
=====================================     
   
Inputs {.sidebar data-width=300}
-------------------------------------

```{r, chunk-10, include=FALSE, cache=FALSE}
# shiny inputs defined here


```

Row {data-height=400}
-------------------------------------

### Map 1

```{r, chunk-11}



```

### Map 2

```{r, chunk-12}



```   

Row {data-height=500}
-------------------------------------  
### Analysis

```{r, chunk-13}
```



Dataset {data-orientation=rows}
=====================================     

### NHGIS 1990,2000,2010 & ACS 2010, 2015

This data table is a sample of the full dataset, including only those variables used in the narratives of this dashboard. Additionally, due to the size of the tidy dataset used in this dashboard, this is only the first 800 observations. For a full dataset, please visit ("link here"). 

```{r, chunk-14, include=FALSE}
dat.url <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/tidy.dashboard.dat.csv"
table.dat <- read.csv( dat.url, stringsAsFactors=F )

table.dat <- table.dat[1:800,]

```

```{r, include=FALSE}
these.buttons <- c( 'copy', 'csv', 'excel' )

dat.selected.table <- datatable( table.dat,
           filter='top', rownames=FALSE, 
           #options=list( pageLength=50, autoWidth=TRUE ),
           fillContainer=TRUE, 
           style="default",
           class='table-condensed table-striped',
           extensions = 'Buttons', 
           options=list( dom='Bfrtip', 
                         buttons=these.buttons  )) %>%
  formatStyle( "GISJOIN", "white-space"="nowrap" )



```

```{r}

selected.datatable

```

Variable Crosswalk {data-orientation=rows}
=====================================     
   

### Data Table Variable Names

This data table includes the names of the different variables from 1990-2015. Notes that 1990, 2000, and 2010 are the variable names from the NHGIS time series data tables downloaded at ("link goes here"). The 2015 variable names are those used to download data from the ACS 5 using the censusapi() package ("link goes here").

```{r, chunk-15, include=FALSE}

url2 <- "https://raw.githubusercontent.com/lecy/neighborhood_change_phx/master/data/phx.variable.name.crosswalk.csv"

phx.var.crosswalk <- read.csv( url2, stringsAsFactors = F)

these.buttons <- c( 'copy', 'csv', 'excel' )

phx.var.datatable <- datatable( phx.var.crosswalk,
           filter='top', rownames=FALSE, 
           #options=list( pageLength=50, autoWidth=TRUE ),
           fillContainer=TRUE, 
           style="default",
           class='table-condensed table-striped',
           extensions = 'Buttons', 
           options=list( dom='Bfrtip', 
                         buttons=these.buttons  )) %>%
  formatStyle( "construct", "white-space"="nowrap" )

```

```{r}
phx.var.datatable
```
